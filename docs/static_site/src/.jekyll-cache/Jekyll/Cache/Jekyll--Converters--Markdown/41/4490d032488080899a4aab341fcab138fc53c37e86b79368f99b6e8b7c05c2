I"Ô&<!--- Licensed to the Apache Software Foundation (ASF) under one -->
<!--- or more contributor license agreements.  See the NOTICE file -->
<!--- distributed with this work for additional information -->
<!--- regarding copyright ownership.  The ASF licenses this file -->
<!--- to you under the Apache License, Version 2.0 (the -->
<!--- "License"); you may not use this file except in compliance -->
<!--- with the License.  You may obtain a copy of the License at -->

<!---   http://www.apache.org/licenses/LICENSE-2.0 -->

<!--- Unless required by applicable law or agreed to in writing, -->
<!--- software distributed under the License is distributed on an -->
<!--- "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY -->
<!--- KIND, either express or implied.  See the License for the -->
<!--- specific language governing permissions and limitations -->
<!--- under the License. -->

<h1 id="github-contribution-and-pr-verification-tips">GitHub contribution and PR verification tips</h1>

<p>Use this page for general git workflow tips.</p>

<h2 id="setup-and-configure">Setup and configure</h2>

<p>It is recommended that you fork the MXNet repo, and then set the original repo as an upstream remote repo.</p>

<p>Fork <a href="https://github.com/apache/incubator-mxnet">https://github.com/apache/incubator-mxnet</a> then:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone --recursive https://github.com/your_username/incubator-mxnet
cd mxnet
git remote add upstream https://github.com/apache/incubator-mxnet
</code></pre></div></div>

<p>Once <code class="highlighter-rouge">upstream</code> was added, then create a branch for your contribution.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch your-contribution-branch
</code></pre></div></div>

<p>Note that you can incorporate the changes from <code class="highlighter-rouge">upstream</code> to any of your local branches during or after development via:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git fetch upstream
git rebase upstream/master
</code></pre></div></div>

<p>See <a href="https://stackoverflow.com/questions/3357122/git-pull-vs-git-fetch-vs-git-rebase">this stackoverflow discussion</a> for more details about difference between <code class="highlighter-rouge">git pull</code>, <code class="highlighter-rouge">git rebase</code> and <code class="highlighter-rouge">git merge</code>.</p>

<p>Since Apache MXNet 3rd party git submodules, to update their changes on your branch after rebase, you can run:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git submodule update --recursive
</code></pre></div></div>

<h2 id="save-your-local-changes-for-future">Save your local changes for future</h2>

<p>During development, you can save your current changes in your branch before committing anything. For example to go to another branch to do something else via:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git stash save
</code></pre></div></div>

<p>To restore the changes so that they can be added to a commit use:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git stash pop
</code></pre></div></div>

<p>To drop the changes, use:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git stash drop
</code></pre></div></div>

<h2 id="reset">Reset</h2>

<p>Sometimes, if you want to wipe out the changes you have made you can use:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reset --hard
</code></pre></div></div>

<p>Be very careful since hard-reset removes any of the changes and youâ€™ll be back to the HEAD commit. To remove all the changed before a commit given its commit-SHA you can use <code class="highlighter-rouge">git reset --hard commit-SHA</code> or <code class="highlighter-rouge">git reset --hard HEAD~2</code> to remove relative to the first two commits on top of HEAD.</p>

<p>However, sometimes itâ€™s useful to keep the files/changes staged when moving the HEAD which can be done via 
<code class="highlighter-rouge">git reset --soft</code>. All of the files changed between the original HEAD and the commit will be staged.</p>

<p>In <a href="https://stackoverflow.com/a/50022436">summary</a>,</p>

<ul>
  <li><strong><code class="highlighter-rouge">--soft</code></strong>: <strong>uncommit</strong> changes, changes are left staged (<em>index</em>).</li>
  <li><strong><code class="highlighter-rouge">--mixed</code></strong> <em>(default)</em>: <strong>uncommit + unstage</strong> changes, changes are left in <em>working tree</em>.</li>
  <li><strong><code class="highlighter-rouge">--hard</code></strong>: <strong>uncommit + unstage + delete</strong> changes, nothing left.</li>
</ul>

<h2 id="recover-a-previous-commit-after-reset">Recover a previous commit after reset</h2>

<p>Sometimes you might mistakenly reset a branch to a wrong commit. When that happens, you can use the following command to show the list of recent commits:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reflog
</code></pre></div></div>

<p>Once you get the right hashtag, you can use git reset again to change the head to the right commit.</p>

<h2 id="how-to-resolve-conflict-with-master">How to resolve conflict with master</h2>

<p>Sometimes when rebasing to the most recent master as explained above, git may show you there are some conflicts which it cannot resolve. These changes will not be merged. For examples, your file <code class="highlighter-rouge">conflict.py</code> has some conflicts with the master branch. Here you need to:</p>

<ul>
  <li>manually modify the file to resolve the conflict.</li>
  <li>After you resolved the conflict, mark it as resolved by:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add conflict.py
</code></pre></div></div>

<ul>
  <li>Then you can continue rebase by:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rebase --continue
</code></pre></div></div>

<ul>
  <li>Finally push to your fork, you may need to <strong>force push</strong> here:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push --force
</code></pre></div></div>

<p><strong>Note</strong> that force push is okay when itâ€™s on your branch and you are the only one who is using that branch. Otherwise, it can have bad consequences as itâ€™s rewritten the history.</p>

<h2 id="how-to-group-multiple-commits-into-one">How to group multiple commits into one</h2>

<p>Sometimes, you may have added a lot of related commits suitable to be grouped/combined together to create one meaningful atomic commit. For example, when later commits are only fixes to previous ones, in your PR. 
If you havenâ€™t configured your default git editor, do the following once:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config core.editor the-editor-you-like
</code></pre></div></div>

<p>Assume we want to merge the last 3 commits.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rebase -i HEAD~3
</code></pre></div></div>

<ol>
  <li>It will pop up an text editor. Set the <strong>first commit as pick,</strong> and <strong>change later ones to squash</strong>.</li>
  <li>After you saved the file, it will pop up another text editor to ask you modify the combined commit message.</li>
  <li>Push the changes to your fork, you need to force push.</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push --force
</code></pre></div></div>

<p><strong>Note</strong> that force push is okay when itâ€™s on your branch and you are the only one who is using that branch. Otherwise, it can have bad consequences as itâ€™s rewritten the history.</p>

<h2 id="apply-only-k-latest-commits-on-to-the-master">Apply only k-latest commits on to the master</h2>

<p>Sometimes it is useful to only apply your k-latest changes on top of the master. This usually happens when you have other m-commits that are already merged before these k-commits. Directly rebase against the master might cause merge conflicts on these first m-commits (which can be safely discarded).</p>

<p>You can instead use the following command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># k is the concrete number. Put HEAD~2 for the last 1 commit.
git rebase --onto upstream/master HEAD~k
</code></pre></div></div>

<p>You can then force push to the master <code class="highlighter-rouge">git push --force</code>. Note that the above command will discard all the commits before the last k ones.</p>

<h2 id="what-is-the-consequence-of-force-push">What is the consequence of force push</h2>

<p>The last three tips require the force push, this is because we altered the path of the commits. <strong>It is fine to force push to your own fork, as long as the commits changed are only yours.</strong> In case there are multiple collaborators who use your branch there is a safer option <code class="highlighter-rouge">git push --force-with-lease.</code></p>

<h2 id="pr-verification">PR verification</h2>

<p>When sending a pull request, remember to add some tests. During the development, one can set <code class="highlighter-rouge">MXNET_TEST_COUNT=1000/10000</code> to test on some randomly selected test cases. This makes the testing and development cycle faster. Moreover, some test results might change due to the seed in pseudo-random number generator. To fix the seed during testing, set <code class="highlighter-rouge">MXNET_TEST_SEED=your seed number</code>.</p>
:ET