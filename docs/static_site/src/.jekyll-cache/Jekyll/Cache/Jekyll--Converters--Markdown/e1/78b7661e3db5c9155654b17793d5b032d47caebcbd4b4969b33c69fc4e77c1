I"¹<!--- Licensed to the Apache Software Foundation (ASF) under one -->
<!--- or more contributor license agreements.  See the NOTICE file -->
<!--- distributed with this work for additional information -->
<!--- regarding copyright ownership.  The ASF licenses this file -->
<!--- to you under the Apache License, Version 2.0 (the -->
<!--- "License"); you may not use this file except in compliance -->
<!--- with the License.  You may obtain a copy of the License at -->

<!---   http://www.apache.org/licenses/LICENSE-2.0 -->

<!--- Unless required by applicable law or agreed to in writing, -->
<!--- software distributed under the License is distributed on an -->
<!--- "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY -->
<!--- KIND, either express or implied.  See the License for the -->
<!--- specific language governing permissions and limitations -->
<!--- under the License. -->

<h1 id="debugging-and-performance-optimization-tips">Debugging and performance optimization tips</h1>

<p>The general workflow when defining your network with Gluon API is either:</p>

<ul>
  <li>
    <p>build sequentially using <code class="highlighter-rouge">nn.Sequential</code> or <code class="highlighter-rouge">nn.HybridSequential</code></p>
  </li>
  <li>
    <p>inherit from <code class="highlighter-rouge">nn.Block</code> or <code class="highlighter-rouge">nn.HybridBlock</code></p>
  </li>
</ul>

<h2 id="debugging">Debugging</h2>

<p>When debugging your MXNet code, remember the following:</p>

<p><strong>Do NOT hybridize for debugging</strong></p>

<p>The difference between <a href="/versions/1.2.1/architecture/program_model.html">imperative style (Gluon non-hybridized) and symbolic style (Gluon hybridized)</a> is:</p>

<ul>
  <li><em>imperative style</em> is <em>define-by-run</em></li>
  <li><em>symbolic style</em> is <em>define-then-run</em></li>
</ul>

<p>Basically, that means the execution path changes when calling <code class="highlighter-rouge">hybridize</code> on your network inherited from <code class="highlighter-rouge">HybridBlock</code> or <code class="highlighter-rouge">HybridSequential</code> (note that inheriting directly from <code class="highlighter-rouge">Block</code> is the same as not hybridizing your network). For efficiency, symbolic code does not keep the intermediate results and so it would be hard to debug and examine the intermediate outputs. Therefore, if you want to <em>examine the intermediate results for debugging, do NOT hybridize</em>. Once everything is working as expected, then you can <code class="highlighter-rouge">hybridize</code> and enjoy the speed up.</p>

<p>Please checkout the <a href="http://d2l.ai/chapter_computational-performance/hybridize.html?highlight=hybridize#hybrid-programming">d2l</a> for more details about the hybrid-programming model.</p>

<h2 id="use-naive-engine">Use naive engine</h2>

<p>It is also useful to set the environment variable <code class="highlighter-rouge">MXNET_ENGINE_TYPE='NaiveEngine'</code> prior to running your (end-to-end) code. This setting disables multi-threading and the execution engine will be synchronous, so you can examine the backtrace more easily. Remember to change it back to either the default <code class="highlighter-rouge">'ThreadedEnginePerDevice'</code> or <code class="highlighter-rouge">'ThreadedEngine'</code>.</p>

<p>For more details, here is a comprehensive tutorial on interactive debugging on <a href="https://www.youtube.com/watch?v=6-dOoJVw9_0">YouTube</a>.</p>

<h2 id="performance-optimization">Performance optimization</h2>

<p>Following up on using the environment variable <code class="highlighter-rouge">MXNET_ENGINE_TYPE</code> for debugging, here are the <a href="/api/faq/env_var">available environment variables</a>  that affect the performance of your code.</p>

<p>Please refer to <a href="https://www.slideshare.net/ThomasDelteil1/debugging-and-performance-tricks-for-mxnet-gluon">this presentation</a> for more information on debugging and performance optimization.</p>

:ET