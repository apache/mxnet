I"i<!--- Licensed to the Apache Software Foundation (ASF) under one -->
<!--- or more contributor license agreements.  See the NOTICE file -->
<!--- distributed with this work for additional information -->
<!--- regarding copyright ownership.  The ASF licenses this file -->
<!--- to you under the Apache License, Version 2.0 (the -->
<!--- "License"); you may not use this file except in compliance -->
<!--- with the License.  You may obtain a copy of the License at -->

<!---   http://www.apache.org/licenses/LICENSE-2.0 -->

<!--- Unless required by applicable law or agreed to in writing, -->
<!--- software distributed under the License is distributed on an -->
<!--- "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY -->
<!--- KIND, either express or implied.  See the License for the -->
<!--- specific language governing permissions and limitations -->
<!--- under the License. -->

<h1 id="exception-handing-and-custom-error-types">Exception handing and custom error types</h1>

<p>Apache MXNet v1.7 has added the custom error type support and as a result <code class="highlighter-rouge">MXNetError</code> is inherited from <code class="highlighter-rouge">RuntimeError</code> so it is possible to register a custom error type in the backend and prepend its error message. Then in the frontend, one can throw the exception of the registered error type.</p>

<p>For example, we want the <code class="highlighter-rouge">transpose</code> operator defined in the C++ backend to throw <code class="highlighter-rouge">ValueError</code> type in the Python frontend. Therefore, in the C++ backend we can add this check:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CHECK_EQ(axes_set.size(), axes.ndim()) &lt;&lt; "ValueError: Repeated axis in transpose."
                                       &lt;&lt; " param.axes = "
                                       &lt;&lt; param.axes;
</code></pre></div></div>

<p>so that on the frontend, when a problematic <code class="highlighter-rouge">transpose</code> call is made such as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from mxnet import np

dat = np.random.normal(0, 1, (3, 4, 5))
dat.transpose((0, 0, 1))
</code></pre></div></div>

<p>the following traceback will be produced:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ValueError                                Traceback (most recent call last)
&lt;ipython-input-3-3ad259b4e371&gt; in &lt;module&gt;
----&gt; 1 dat.transpose((0, 0, 1))

~/mxnet-distro/mxnet-build/python/mxnet/numpy/multiarray.py in transpose(self, *axes)
   1460             elif axes[0] is None:
   1461                 axes = None
-&gt; 1462         return _mx_np_op.transpose(self, axes=axes)
   1463
   1464     def flip(self, *args, **kwargs):
~/mxnet-distro/mxnet-build/python/mxnet/ndarray/register.py in transpose(a, axes, out, name, **kwargs)

~/mxnet-distro/mxnet-build/python/mxnet/_ctypes/ndarray.py in _imperative_invoke(handle, ndargs, keys, vals, out, is_np_op, output_is_list)
    105         c_str_array(keys),
    106         c_str_array([str(s) for s in vals]),
--&gt; 107         ctypes.byref(out_stypes)))
    108
    109     create_ndarray_fn = _np_ndarray_cls if is_np_op else _ndarray_cls
    
~/mxnet-distro/mxnet-build/python/mxnet/base.py in check_call(ret)
    271     """
    272     if ret != 0:
--&gt; 273         raise get_last_ffi_error()
    274
    275
ValueError: Traceback (most recent call last):
  File "src/operator/numpy/np_matrix_op.cc", line 77
  
ValueError: Check failed: axes_set.size() == axes.ndim() (2 vs. 3) : Repeated axis in transpose. param.axes = [0,0,1]
</code></pre></div></div>

<p>Note that as of writing this document, the following Python error types are supported:</p>

<ul>
  <li><code class="highlighter-rouge">ValueError</code></li>
  <li><code class="highlighter-rouge">TypeError</code></li>
  <li><code class="highlighter-rouge">AttributeError</code></li>
  <li><code class="highlighter-rouge">IndexError</code></li>
  <li><code class="highlighter-rouge">NotImplementedError</code></li>
</ul>

<p>Check <a href="https://github.com/apache/incubator-mxnet/blob/master/python/mxnet/error.py">this</a> resource for more details
about Python supported error types that MXNet supports.</p>

<h2 id="how-to-register-a-custom-error-type">How to register a custom error type</h2>

<p>Here is the way to register a custom error type in Python frontend:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import mxnet as mx

@mx.error.register
class MyError(mx.MXNetError):
    def __init__(self, msg):
        super().__init__(msg)
</code></pre></div></div>

<p>Then in the C++ backend, you can refer to <code class="highlighter-rouge">MyError</code> via:</p>

<p><code class="highlighter-rouge">LOG(FATAL) &lt;&lt; "MyError: this is a custom error message"</code></p>
:ET